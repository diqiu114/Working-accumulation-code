# 平衡车姿态控制：

## 姿态控制由几部分够成：

1. 姿态控制输出量：平衡车中是电机的功率
2. 姿态控制输入量：平衡车中主要的是6轴mpu
3. 姿态控制算法：联级pid算法

姿态控制输入量中需要有融合算法，此处用的融合算法为 mahony，融合算法需要定时调用，调用周期要比较精确，还要考虑数据是否准备好的问题，这里一般是要提高mpu的自采样速度，然后读取数据是否准备好时，直接用mpu的int脚去读，像用iic去读是否准备好的寄存器，就占用时间片比较严重，重点就是要节省融合算法的时间。



姿态控制算法中需要定时调用，时间越短越好



## mpu的6轴数据意义：

​	加速度：是按照几个重力加速度再除以精度（比如16位）为单位的

​	角速度：单位弧度每秒，但是采集到的数据是dps(degree per second，度每秒)，当精度为±2000dps时，采集的数据，65536就是4000度每秒，计算灵敏度时（每 dps 对应多少整数）：就是65536/4000dps ≈16.384，所以采集到的原始值/16.4就是度每秒，转为角速度公式：

```
#define DEG_TO_RAD(*x*) (x * PI / 180.0f)
```





# mahony算法调参：

### 1. **比例项（Kp）**

- **作用：** 调整角速度误差的即时反馈。
- **影响：**
  - **增大Kp**：姿态估计反应更快，对外部扰动或姿态变化能快速纠正。
  - **减小Kp**：反应变慢，姿态调整更“平滑”但可能存在滞后。
- **风险：**
  - 如果Kp太大，容易导致估计振荡或不稳定。
  - 太小则可能对快速运动反应不足。

------

### 2. **积分项（Ki）**

- **作用：** 对长时间累积的陀螺仪漂移（偏置）进行补偿。
- **影响：**
  - **增大Ki**：更快地纠正陀螺仪偏置（尤其对长时间运行有效）。
  - **减小Ki**：偏置校正变慢，可能会有残余漂移。
- **风险：**
  - 如果Ki太大，可能引入振荡或过度纠正。
  - Ki为0时，不会进行陀螺仪偏置修正（等价于关闭积分反馈）。

### 实际调参建议：

1. **先设置一个较高的Kp**（如5~10），观察系统响应是否迅速并无震荡；
2. **再慢慢增加Ki**，从0开始小步增加（如0.01 ~ 0.1），观察长时间运行中漂移是否改善；
3. **在动态运动与静态状态下都测试**，确保既有快速响应，又无慢性漂移。
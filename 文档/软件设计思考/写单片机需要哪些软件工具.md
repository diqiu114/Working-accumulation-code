## 软件基础

当软件不带rtos时，推荐软件基础中应该带有极轻量级别的，以下任选一种或多种的：

1. 事件系统
2. 软定时调用（类协作式rtos）
3. 缓冲机制：队列、邮箱

1.精准统一的ms延时
2.精准统一的us延时
3.计算数组长度
4.crc
4.断言库（null检查库）
5.日志库
6.字符串处理库：Simple Dynamic String
7.内存分配：
8.字符串传递：
	单片机间：原始字符串，不带'\0'
	单片机内：带'\0'

关于版本控制
		关于分支：当一个项目制定后，对它进行开发过程中，应该存在一个release分支，以及一个或多个开发分支（用于新功能的开发）
release分支通常为稳定程序，作为生产的程序使用
		关于文档控制：每个项目文件中，应该有一个readme文件，用来说明项目：release发布说明（添加git版本的哈希值这种方式更明了）、软件架构、协议设计等等

关于日志：
		初始化：不管是硬件软件初始化，初始化成功或者失败，都要打印初始化信息，暂定格式为：某某东西初始化成功/失败
	
	

## 软件结构

一切的app要放在看门狗启用之后运行
241009：当前思考到的方案为:

软件项目的迭代一般要求

1. 驱动增删查改灵活、清晰
2. 功能增删查改灵活、清晰

当基于编码内容去控制驱动时，如：使用C语言中宏划分，这会导致在日益维护的过程中，板子越来越多，宏划分的驱动越来越臃肿，后续的增删查改愈发困难。

改进方法：基于文件去控制驱动，如：项目1中，led驱动gpio为GPIO1  PIN1，项目2中，led驱动gpio为GPIO2，PIN2，此时，就应该新建led驱动文件为《项目2 led驱动》，当然项目中不止led一个功能，还可能有adc采样等功能，这些功能都会使用gpio，《项目2 led驱动》这里可以更进一步优化，更改为《项目2 gpio驱动》。

总结：每当产生与根版本不同的硬件引用，如gpio变化、adc变化；每当产生与根版本不同的app功能时，如：新增led blink功能；此时，应当新建一个文件，并注释掉旧的功能、驱动文件。

上述方法问题1：

​	初始化问题

​		如何初始化驱动、app？使用方法如：在main中去一个一个加吗，今天项目1添加led功能，于是在main中加入led_init，明天项目1添加adc功能，于是在mian中加入adc_init，后天另一个项目2又要使用led功能，于是从项目一中复制过来led功能的相关文件，然后又去项目2中的mian中加入led_init，这样可太麻烦了（光写文字我都觉得麻烦），既然我们是基于文件为单位编写好软件，有没有方式直接在本文件中初始化？有的，rt thread就提供了一种方式。



### 基于上述产生以下

​	一个功能的逻辑实现、硬件驱动应当放在一个文件夹下，这样的好处是，在其他项目上使用该功能时，直接将该文件夹移动过去后，直接就可以使用。

1. 一个功能对应分为：

   1. 功能的逻辑实现

      1. 有rtos系统
         1. 各功能分别为一rtos任务
         2. 任务有一顶级源文件，该任务负责所有子任务的调度、初始化，该任务自己的初始化应当在本文件中初始化
         3. 任务的优先级处理
            1. ？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？
      2. 无rtos系统
         1. 有限采用事件循环、定时任务循环等方式进行功能实现，功能划分因该也像有rtos系统中那样，有一顶源文件协调。

   2. 功能的硬件驱动：

      1. 硬件驱动抽象出，当功能逻辑实现实现部分调用时，完全与硬件不相干，如高电平点亮状态灯led，此时不应该出现此类接口：

         ```
           HAL_GPIO_WritePin(LED_Port, LED_STATE_Pin, HIGH_LEVEL);
         ```

         应该类似为此接口示例：

         ```
         state_led_set(Bright);
         ```

         2. 硬件驱动

            应该写成独立的文件，如led驱动，应该有区别于硬件抽象接口文件产生以下独立文件:

            1. led的gpio驱动：led_gpio.c
            2. led的adc驱动：led_adc.c
            3. led的dma驱动：led_dma.c

            当驱动较为简单时，此部分可写成一个文件，以上文件，推荐共用一个头文件，gpio可再使用一个头文件，编译bsp适配。

            

